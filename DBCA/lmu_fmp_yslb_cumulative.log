################################################################################
# psql_command.sh
#    --command "
SELECT description, 
ST_Area(fmp_geom::geography) / 10000 as fmp_area, 
SUM(ST_Area(geom::geography)) FILTER (WHERE yslb <= 2)    / ST_Area(fmp_geom::geography) * 100 AS yslb_0_to_2,
SUM(ST_Area(geom::geography)) FILTER (WHERE yslb <= 5)    / ST_Area(fmp_geom::geography) * 100 AS yslb_to_5,
SUM(ST_Area(geom::geography)) FILTER (WHERE yslb <= 11)   / ST_Area(fmp_geom::geography) * 100 AS yslb_to_11,
SUM(ST_Area(geom::geography)) FILTER (WHERE yslb <= 24)   / ST_Area(fmp_geom::geography) * 100 AS yslb_to_24,
SUM(ST_Area(geom::geography)) FILTER (WHERE yslb >= 25)   / ST_Area(fmp_geom::geography) * 100 AS yslb_25_plus,
SUM(ST_Area(geom::geography)) FILTER (WHERE yslb IS NULL) / ST_Area(fmp_geom::geography) * 100 AS yslb_unknown
FROM (
      SELECT description, land_management_unit.fmp_geom, poly.geom, ${refyear} - fireseason(event.fih_date1) AS yslb
      FROM land_management_unit
      JOIN southern_land_management_unit_junction AS lmu_junction ON lmu_junction.extcode = land_management_unit.extcode
      JOIN southern_view AS view ON view.poly_id = lmu_junction.poly_id
      JOIN southern_poly AS poly ON poly.id = view.poly_id
      LEFT OUTER JOIN dbca_fire_history_dbca_060 AS event ON event.object_id = view.dbca_fire_history_dbca_060_object_id[1]
      WHERE forest_man_plan_2014_2023_dbca_041_id IS NOT NULL) foo
GROUP BY description, fmp_geom"
#    --csvfile "lmu_fmp_yslb_cumulative_${refyear}.csv"
################################################################################
